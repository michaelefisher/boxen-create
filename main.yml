#! /usr/bin/env ansible-playbook

---
- hosts: all
  gather_facts: yes
  vars:
   - user: "{{ ansible_env.LOGNAME }}"
   - home: "{{ ansible_env.HOME }}"
   - zsh_custom: "{{ home }}/.oh-my-zsh/custom"
   - git_dir: "{{ home }}/git"
   - python_site: "{{ home}}/.local/bin/"
   - civis_redshift_user: "michaelfisher"
  environment:
   - PATH: "{{ ansible_env.PATH }}"

  tasks:
    - name: Install other things in Linux
      apt:
        name:
          - gnupg2
          - libpq-dev
          - powerline
          - fonts-powerline
          - awscli
          - bzip2
          - libffi-dev
          - libyaml-dev
          - silversearcher-ag
      when: ansible_os_family == 'Debian'
      become: true
      become_method: sudo
      tags:
        - files,ruby

    - name: Install snaps
      snap:
        name: node
        classic: yes
      when: ansible_os_family == 'Debian'
      become: true
      become_method: sudo
      tags:
        - files

    - name: Upgrade Linux packages
      apt:
        upgrade: dist
      become: true
      become_method: sudo
      when: ansible_os_family == 'Debian'

    - import_tasks: brew.yml
      when: ansible_os_family == 'Darwin'
      tags:
        - brew

    - import_tasks: files.yml
      tags:
        - files

    - import_tasks: ruby.yml
      tags:
        - ruby

    - import_tasks: python.yml
      tags:
        - python

    - import_tasks: website.yml
      tags:
        - website
      when: ansible_os_family != 'Darwin' and inventory_hostname == 'website'

